<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intellihub.governance.mapper.ApiCallLogMapper">

    <!-- 按API ID统计今日调用次数 -->
    <select id="countTodayCallsByApiId" resultType="map">
        SELECT 
            api_id AS apiId,
            COUNT(*) AS callCount
        FROM api_call_log
        WHERE api_id IS NOT NULL
          AND request_time >= #{startTime}
          AND request_time &lt;= #{endTime}
        GROUP BY api_id
    </select>

    <!-- 按API ID统计历史总调用次数 -->
    <select id="countTotalCallsByApiId" resultType="map">
        SELECT 
            api_id AS apiId,
            COUNT(*) AS callCount
        FROM api_call_log
        WHERE api_id IS NOT NULL
        GROUP BY api_id
    </select>

    <!-- 按App ID统计总调用次数（配额使用） -->
    <select id="countCallsByAppId" resultType="map">
        SELECT 
            app_id AS appId,
            COUNT(*) AS callCount
        FROM api_call_log
        WHERE app_id IS NOT NULL 
          AND app_id != ''
        GROUP BY app_id
    </select>

    <!-- 获取今日有调用的API ID列表 -->
    <select id="selectTodayCalledApiIds" resultType="string">
        SELECT DISTINCT api_id
        FROM api_call_log
        WHERE api_id IS NOT NULL
          AND request_time >= #{startTime}
          AND request_time &lt;= #{endTime}
    </select>

</mapper>
